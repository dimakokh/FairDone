<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FairKiosk — Показ заказов</title>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#0e0e0e;
  --text:#ffffff;
  --card:#151515;
  --border:#222;
  --cook:#c62828;
  --ready:#2e7d32;
}

body.light{
  --bg:#f4f4f4;
  --text:#111;
  --card:#ffffff;
  --border:#ddd;
  --cook:#ff5252;
  --ready:#4caf50;
}

html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,system-ui;
}

.app{
  height:100%;
  display:flex;
  flex-direction:column;
}

header{
  display:flex;
  align-items:center;
  gap:14px;
  padding:16px 24px;
  border-bottom:1px solid var(--border);
}

.board{
  flex:1;
  display:grid;
  grid-template-columns:1fr 1fr;
}

.column{
  display:flex;
  flex-direction:column;
}

.column-header{
  text-align:center;
  padding:14px;
  font-weight:800;
  font-size:18px;
  color:#fff;
}

.cooking .column-header{ background:var(--cook); }
.ready .column-header{ background:var(--ready); }

.list{
  flex:1;
  padding:20px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:16px;
}

.order{
  background:var(--card);
  border-radius:18px;
  height:120px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:36px;
  font-weight:900;
  letter-spacing:3px;
  border:1px solid var(--border);
}
</style>
</head>

<body>
<div class="app">

<header>
  <div style="font-size:20px;font-weight:800">
    FairDone — твой заказ здесь
  </div>
</header>

<div class="board">
  <div class="column cooking">
    <div class="column-header">Готовится</div>
    <div class="list" id="listCooking"></div>
  </div>

  <div class="column ready">
    <div class="column-header">Готово</div>
    <div class="list" id="listReady"></div>
  </div>
</div>

</div>

<script>
const listCooking = document.getElementById('listCooking');
const listReady   = document.getElementById('listReady');

let orders = new Map();
let terminals = JSON.parse(localStorage.getItem('terminals') || '[]');
let spoken = new Set();

function renderOrder(num){
  const d=document.createElement('div');
  d.className='order';
  d.textContent=num;
  return d;
}

function speakOrder(num){
  if(spoken.has(num)) return;
  spoken.add(num);
  try{
    const msg = new SpeechSynthesisUtterance(`Заказ номер ${num} готов`);
    msg.lang = 'ru-RU';
    speechSynthesis.speak(msg);
  }catch(e){}
}

function refresh(){
  listCooking.innerHTML='';
  listReady.innerHTML='';
  if(terminals.length === 0) return;

  for(const [,o] of orders){
    if(!terminals.includes(o.terminalId)) continue;

    if(
      o.status === 'waiting_for_cash' ||
      o.status === 'rejected'
    ) continue;

    if(o.status === 'cooking'){
      listCooking.appendChild(renderOrder(o.orderNumber));
    }

    if(o.status === 'ready' || o.status === 'completed'){
      listReady.appendChild(renderOrder(o.orderNumber));
      speakOrder(o.orderNumber);
    }
  }
}

/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyABvY_6cHonbLvdBj5cYMSheJDLMd_-bNw",
  authDomain: "app-fairpay.firebaseapp.com",
  databaseURL: "https://app-fairpay-default-rtdb.firebaseio.com",
  projectId: "app-fairpay",
  storageBucket: "app-fairpay.firebasestorage.app",
  messagingSenderId: "29576302334",
  appId: "1:29576302334:web:0e559f804bf62c59981faf"
});

const ref = firebase.database().ref('orders');

ref.on('child_added', s=>{
  orders.set(s.key,s.val());
  refresh();
});
ref.on('child_changed', s=>{
  orders.set(s.key,s.val());
  refresh();
});
ref.on('child_removed', s=>{
  orders.delete(s.key);
  refresh();
});
</script>
</body>
</html>
